@{
    ViewData["Title"] = "Verification Page";
    var claims = Model as List<ST10298850_PROG6212_POE.Models.LecturerClaimModel>;
}

<div class="verification-page">
    <!-- Container for the Table and Lecturer Info -->
    <div class="verification-content-container">
        <!-- Table for Claims -->
        <div class="verification-claim-list-box">
            <table class="verification-claim-table">
                <thead>
                    <tr>
                        <th>Claim ID</th>
                        <th>Claim Date</th>
                        <th>Documents</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var claim in claims)
                    {
                        <tr class="claim-row" data-claim-id="@claim.ClaimId">
                            <td>@claim.ClaimId</td>
                            <td>@claim.SubmissionDate.ToString("yyyy-MM-dd")</td>
                            <td>
                                @foreach (var document in claim.Documents)
                                {
                                    <span>@document.DocumentName</span>
                                    <br />
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Lecturer Information -->
        <div class="verification-lecturer-info">
            <div class="verification-info-item">Full Name: <span class="verification-info-value" data-field="fullName">NA</span></div>
            <div class="verification-info-item">Hourly Rate: <span class="verification-info-value" data-field="hourlyRate">NA</span></div>
            <div class="verification-info-item">Department: <span class="verification-info-value" data-field="department">NA</span></div>
            <div class="verification-info-item">Campus: <span class="verification-info-value" data-field="campus">NA</span></div>

            <div class="verification-line-divider"></div>

            <div class="verification-info-item">Regular Hours Worked: <span class="verification-info-value" data-field="hoursWorked">NA</span></div>
            <div class="verification-info-item">Overtime Hours Worked: <span class="verification-info-value" data-field="overtimeWorked">NA</span></div>
            <div class="verification-info-item">Total Hours Worked: <span class="verification-info-value" data-field="totalHours">NA</span></div>

            <div class="verification-line-divider"></div>

            <div class="verification-info-item">Regular Pay: <span class="verification-info-value" data-field="regularPay">NA</span></div>
            <div class="verification-info-item">Overtime Pay: <span class="verification-info-value" data-field="overtimePay">NA</span></div>
            <div class="verification-info-item">Total Pay: <span class="verification-info-value" data-field="totalPay">NA</span></div>
        </div>
    </div>

    <!-- Approve/Reject Buttons -->
    <div class="verification-approve-group">
        <button class="verification-approve-button">Approve</button>
    </div>

    <div class="verification-reject-group">
        <button class="verification-reject-button">Reject</button>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Variable to hold the selected claim ID
        let selectedClaimId = null;

        // Handle row click to set selected claim
        $(".claim-row").click(function () {
            selectedClaimId = $(this).data("claim-id");

            // Send AJAX request to fetch claim details
            $.ajax({
                url: '@Url.Action("GetClaimDetails", "Verification")',
                type: 'GET',
                data: { id: selectedClaimId },
                success: function (data) {
                    $(".verification-info-item span.verification-info-value").each(function () {
                        var key = $(this).data("field");
                        $(this).text(data[key] || "NA");
                    });
                },
                error: function (error) {
                    console.log("Error fetching claim details:", error);
                }
            });
        });

        // Approve button click handler
        $(".verification-approve-button").click(function () {
            if (selectedClaimId) {
                $.ajax({
                    url: '@Url.Action("ApproveClaim", "Verification")', // Your approve action
                    type: 'POST',
                    data: { id: selectedClaimId },
                    success: function () {
                        alert("Claim approved!");
                        location.reload(); // Reload the page or update the UI as necessary
                    },
                    error: function (error) {
                        console.log("Error approving claim:", error);
                    }
                });
            } else {
                alert("Please select a claim to approve.");
            }
        });

        // Reject button click handler
        $(".verification-reject-button").click(function () {
            if (selectedClaimId) {
                $.ajax({
                    url: '@Url.Action("RejectClaim", "Verification")', // Your reject action
                    type: 'POST',
                    data: { id: selectedClaimId },
                    success: function () {
                        alert("Claim rejected!");
                        location.reload(); // Reload the page or update the UI as necessary
                    },
                    error: function (error) {
                        console.log("Error rejecting claim:", error);
                    }
                });
            } else {
                alert("Please select a claim to reject.");
            }
        });
    });
</script>