@{
    ViewData["Title"] = "Verification Page";
    var claims = Model as List<ST10298850_PROG6212_POE.Models.LecturerClaimModel>;
}

<div class="claim-main-content">
    <!-- Container for the Table and Lecturer Info -->
    <div class="claim-container">
        <!-- Table for Claims -->
        <div class="claim-history-column">
            <div class="claim-history">
                <h2>Claims List</h2>
                <table class="claim-history-table">
                    <thead>
                        <tr>
                            <th>Claim ID</th>
                            <th>Claim Date</th>
                            <th>Documents</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (claims != null && claims.Any())
                        {
                            foreach (var claim in claims)
                            {
                                <tr class="clickable-row" data-claim-id="@claim.ClaimId">
                                    <td>@claim.ClaimId</td>
                                    <td>@claim.SubmissionDate.ToString("yyyy-MM-dd")</td>
                                    <td>
                                        @foreach (var document in claim.Documents)
                                        {
                                            <span>@document.DocumentName</span>
                                            <br />
                                        }
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3">No claims available for verification.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Lecturer Information -->
        <div class="claim-form-column">
            <div class="claim-form">
                <h2>Claim Details</h2>
                <div class="form-group">Full Name: <span class="approval-info-value" id="fullName">NA</span></div>
                <div class="form-group">Hourly Rate: <span class="approval-info-value" id="hourlyRate">NA</span></div>
                <div class="form-group">Department: <span class="approval-info-value" id="department">NA</span></div>
                <div class="form-group">Campus: <span class="approval-info-value" id="campus">NA</span></div>
                <hr class="approval-line-divider" />

                <div class="form-group">Regular Hours Worked: <span class="approval-info-value" id="hoursWorked">NA</span></div>
                <div class="form-group">Overtime Hours Worked: <span class="approval-info-value" id="overtimeWorked">NA</span></div>
                <div class="form-group">Total Hours Worked: <span class="approval-info-value" id="totalHours">NA</span></div>
                <hr class="approval-line-divider" />

                <div class="form-group">Regular Pay: <span class="approval-info-value" id="regularPay">NA</span></div>
                <div class="form-group">Overtime Pay: <span class="approval-info-value" id="overtimePay">NA</span></div>
                <div class="form-group">Total Pay: <span class="approval-info-value" id="totalPay">NA</span></div>
                <hr class="approval-line-divider" />
                <div class="form-group">Notes: <span class="approval-info-value" id="notes">NA</span></div>
            </div>
        </div>
    </div>

    <!-- Approve/Reject Buttons -->
    <div class="form-group">
        <button class="btn-signin approval-approve-button">Approve</button>
        <button class="btn-signin approval-reject-button" style="background-color: #e74c3c;">Reject</button>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Variable to hold the selected claim ID
        let selectedClaimId = null;

        // Handle row click to set selected claim
        $(".clickable-row").click(function () {
            selectedClaimId = $(this).data("claim-id");

            // Send AJAX request to fetch claim details
            $.ajax({
                url: '@Url.Action("GetClaimDetails", "Verification")',
                type: 'GET',
                data: { id: selectedClaimId },
                success: function (data) {
                    $("#fullName").text(data.fullName || "NA");
                    $("#hourlyRate").text(data.hourlyRate || "NA");
                    $("#department").text(data.department || "NA");
                    $("#campus").text(data.campus || "NA");
                    $("#hoursWorked").text(data.hoursWorked || "NA");
                    $("#overtimeWorked").text(data.overtimeWorked || "NA");
                    $("#totalHours").text(data.totalHours || "NA");
                    $("#regularPay").text(data.regularPay || "NA");
                    $("#overtimePay").text(data.overtimePay || "NA");
                    $("#totalPay").text(data.totalPay || "NA");
                    $("#notes").text(data.notes || "NA");
                },
                error: function (error) {
                    console.log("Error fetching claim details:", error);
                }
            });
        });

        // Approve button click handler
        $(".approval-approve-button").click(function () {
            if (selectedClaimId) {
                $.ajax({
                    url: '@Url.Action("ApproveClaim", "Verification")',
                    type: 'POST',
                    data: { id: selectedClaimId },
                    success: function () {
                        alert("Claim approved!");
                        location.reload();
                    },
                    error: function (error) {
                        console.log("Error approving claim:", error);
                    }
                });
            } else {
                alert("Please select a claim to approve.");
            }
        });

        // Reject button click handler
        $(".approval-reject-button").click(function () {
            if (selectedClaimId) {
                $.ajax({
                    url: '@Url.Action("RejectClaim", "Verification")',
                    type: 'POST',
                    data: { id: selectedClaimId },
                    success: function () {
                        alert("Claim rejected!");
                        location.reload();
                    },
                    error: function (error) {
                        console.log("Error rejecting claim:", error);
                    }
                });
            } else {
                alert("Please select a claim to reject.");
            }
        });
    });
</script>
